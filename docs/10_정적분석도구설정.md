# 정적 분석 도구 설정 명세서

## 1. 개요

### 1.1 목표

| 구분 | 설명 |
|:-----|:-----|
| ✅ 목표 | 틀리기 쉬운 지점만 컴파일/린트 단계에서 차단 |
| ❌ 비목표 | 규칙 많이 넣기, 스타일 강제 |

### 1.2 설계 원칙

```
┌─────────────────────────────────────────────────────────────┐
│                      책임 분리 원칙                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   TypeScript (strict)  →  타입 안전성                       │
│   ESLint               →  논리적 실수 방지                  │
│   Prettier             →  코드 형식 통일                    │
│                                                             │
│   * ESLint는 Prettier와 충돌하지 않음                       │
│   * 규칙은 "왜 필요한가"가 명확한 것만 포함                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 기술 스택

| 기술 | 버전 | 역할 |
|:-----|:-----|:-----|
| TypeScript | 5.x | 타입 검사 (strict 모드) |
| ESLint | 8.x | 코드 품질 검사 |
| Prettier | 3.x | 코드 포맷팅 |

> **Note**: ESLint 8.x 사용 (`.eslintrc.cjs` 방식). ESLint 9.x의 Flat Config는 플러그인 호환성 이슈가 있어 과제에서는 8.x 권장.

---

## 2. TypeScript 설정

### 2.1 설정 파일

```json
// tsconfig.json
{
  "compilerOptions": {
    /* 빌드 타겟 */
    "target": "ES2020",
    "lib": ["DOM", "DOM.Iterable", "ES2020"],
    "jsx": "react-jsx",

    /* ========================================
       핵심: 타입 안전성
       ======================================== */
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUncheckedIndexedAccess": true,

    /* ========================================
       실수 방지
       ======================================== */
    "noFallthroughCasesInSwitch": true,
    "forceConsistentCasingInFileNames": true,

    /* ========================================
       모듈 시스템
       ======================================== */
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,

    /* ========================================
       경로 별칭
       ======================================== */
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    },

    /* ========================================
       성능
       ======================================== */
    "skipLibCheck": true,

    /* 출력 (Vite가 번들링하므로 noEmit) */
    "noEmit": true
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 2.2 Vite용 Node 설정

```json
// tsconfig.node.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020"],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "noEmit": true
  },
  "include": ["vite.config.ts"]
}
```

### 2.3 핵심 옵션 설명

| 옵션 | 값 | 효과 |
|:-----|:---|:-----|
| `strict` | `true` | 모든 strict 계열 옵션 활성화 |
| `noImplicitAny` | `true` | 암묵적 any 금지 |
| `strictNullChecks` | `true` | null/undefined 명시적 처리 강제 |
| `noUncheckedIndexedAccess` | `true` | 배열/객체 인덱스 접근 시 `undefined` 가능성 포함 |
| `noFallthroughCasesInSwitch` | `true` | switch문 fall-through 방지 |

### 2.4 `noUncheckedIndexedAccess` 효과

```typescript
// API 응답 처리 예시
const tasks: Task[] = response.data;

// noUncheckedIndexedAccess: true (권장)
const first = tasks[0];
// 타입: Task | undefined
// → 빈 배열 가능성을 타입으로 표현

// noUncheckedIndexedAccess: false (위험)
const first = tasks[0];
// 타입: Task
// → 빈 배열이면 런타임 에러
```

**의미**: API 응답을 맹신하지 않는 방어적 코딩 태도 증명

---

## 3. ESLint 설정

### 3.1 필요 패키지

```json
// package.json (devDependencies)
{
  "devDependencies": {
    "eslint": "^8.57.0",
    "@typescript-eslint/parser": "^7.0.0",
    "@typescript-eslint/eslint-plugin": "^7.0.0",
    "eslint-plugin-react": "^7.34.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-config-prettier": "^9.1.0"
  }
}
```

### 3.2 설정 파일

```javascript
// .eslintrc.cjs
module.exports = {
    root: true,
    parser: '@typescript-eslint/parser',

    parserOptions: {
        ecmaVersion: 'latest',
        sourceType: 'module',
        ecmaFeatures: { jsx: true },
    },

    env: {
        browser: true,
        es2021: true,
    },

    plugins: [
        '@typescript-eslint',
        'react',
        'react-hooks',
    ],

    extends: [
        /* 기본 규칙 */
        'eslint:recommended',

        /* TypeScript
           - recommended는 타입 오류 가능성이 높은 규칙만 포함
           - 스타일/취향 규칙은 Prettier 및 명시적 off로 통제 */
        'plugin:@typescript-eslint/recommended',

        /* React */
        'plugin:react/recommended',
        'plugin:react-hooks/recommended',

        /* Prettier 충돌 제거 (반드시 마지막) */
        'prettier',
    ],

    settings: {
        react: {
            version: 'detect',
        },
    },

    rules: {
        /* ========================================
           TypeScript 핵심 규칙
           ======================================== */

        // any 사용 금지 → 타입 안전성의 핵심
        '@typescript-eslint/no-explicit-any': 'error',

        // import type 강제 → 번들 최적화 + 의도 명확
        '@typescript-eslint/consistent-type-imports': 'error',

        // 미사용 변수 금지 (_ prefix는 허용)
        '@typescript-eslint/no-unused-vars': [
            'error',
            { argsIgnorePattern: '^_' },
        ],

        /* ========================================
           React / Hooks
           ======================================== */

        // React 17+ JSX Transform 사용
        'react/react-in-jsx-scope': 'off',
        'react/jsx-uses-react': 'off',

        // TypeScript가 prop-types 대체
        'react/prop-types': 'off',

        /* ========================================
           일반 코드 품질
           ======================================== */

        // console.log 남용 방지 (warn, error는 허용)
        'no-console': ['warn', { allow: ['warn', 'error'] }],
    },

    ignorePatterns: [
        'dist',
        'node_modules',
        '*.config.js',
        '*.config.cjs',
    ],
};
```

### 3.3 규칙 선정 근거

| 규칙 | 수준 | 선정 이유 |
|:-----|:-----|:----------|
| `@typescript-eslint/no-explicit-any` | error | 타입 안전성의 가장 강한 신호 |
| `@typescript-eslint/consistent-type-imports` | error | 타입/값 구분 명확, 번들 최적화 |
| `@typescript-eslint/no-unused-vars` | error | 죽은 코드 방치 방지 |
| `react-hooks/rules-of-hooks` | error | Hooks 규칙 위반은 런타임 버그 |
| `react-hooks/exhaustive-deps` | warn | 의존성 누락 경고 (아래 상세 설명) |
| `no-console` | warn | 디버깅 코드 잔류 방지 (아래 상세 설명) |

### 3.4 warn 수준 선택 근거

#### `react-hooks/exhaustive-deps: warn`

`exhaustive-deps`는 경우에 따라 의도적인 생략이 가능하므로 경고(warn) 수준으로 설정하여 개발자의 판단 여지를 남겼다.

```typescript
// 의도적 생략이 합리적인 케이스
useEffect(() => {
  // 컴포넌트 마운트 시 1회만 실행 의도
  initializeApp();
}, []); // 빈 배열은 의도적 선택

// error로 설정하면 매번 eslint-disable 필요 → 노이즈 증가
```

#### `no-console: warn`

`console.warn`, `console.error`는 허용하여 에러 추적 용도로 사용 가능하다. MSW 디버깅 등 개발 단계에서 필요한 경우 `console.warn`으로 대체하거나, 해당 라인에서 일시적으로 비활성화할 수 있다.

```typescript
// 허용되는 패턴
console.warn('[MSW] Handler registered');
console.error('API Error:', error);

// 경고 발생 (의도적으로 남기지 않도록 유도)
console.log('debug:', data);
```

### 3.5 의도적으로 제외한 규칙

| 규칙 | 제외 이유 |
|:-----|:----------|
| `import/order` | Prettier/IDE가 처리 가능, 과제에서 필수 아님 |
| `react/display-name` | 개발 편의성 저하 대비 이득 적음 |
| 스타일 관련 규칙 전체 | Prettier가 담당 |
| `@typescript-eslint/explicit-function-return-type` | TypeScript 추론으로 충분 |

### 3.6 `recommended` 확장과 "규칙 최소화" 원칙

> **Q**: `recommended`는 규칙이 많은데, "규칙 최소화" 원칙과 충돌하지 않는가?

**A**: 충돌하지 않는다.

| 구분 | 설명 |
|:-----|:-----|
| `recommended`의 역할 | 타입 오류 가능성이 높은 **안전성 규칙**만 포함 |
| 스타일 규칙 | `recommended`에 포함되지 않음 → Prettier가 담당 |
| 불필요한 규칙 | `explicit-function-return-type` 등은 명시적으로 off |

`recommended`는 "많은 규칙"이 아니라 "검증된 최소 규칙 세트"이다. 여기에 스타일 규칙을 추가하지 않고, 오히려 일부를 off 처리함으로써 "규칙 최소화" 원칙을 유지한다.

---

## 4. Prettier 설정

### 4.1 설정 파일

```json
// .prettierrc
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

### 4.2 무시 파일

```
# .prettierignore
dist
node_modules
*.min.js
pnpm-lock.yaml
package-lock.json
```

### 4.3 옵션 설명

| 옵션 | 값 | 설명 |
|:-----|:---|:-----|
| `semi` | `true` | 세미콜론 사용 |
| `singleQuote` | `true` | 문자열에 작은따옴표 |
| `trailingComma` | `all` | 후행 쉼표 (git diff 깔끔) |
| `printWidth` | `80` | 한 줄 최대 길이 |
| `endOfLine` | `lf` | 줄바꿈 문자 통일 |

---

## 5. package.json 스크립트

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",

    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix",

    "format": "prettier --write \"src/**/*.{ts,tsx,css,json}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,css,json}\"",

    "type-check": "tsc --noEmit"
  }
}
```

### 스크립트 용도

| 스크립트 | 용도 | 실행 시점 |
|:---------|:-----|:----------|
| `lint` | ESLint 검사 | 개발 중 수시 |
| `lint:fix` | ESLint 자동 수정 | 커밋 전 |
| `format` | Prettier 포맷팅 | 커밋 전 |
| `format:check` | 포맷팅 검사만 | CI/검증 |
| `type-check` | 타입 검사만 | 빌드 전 확인 |

---

## 6. VS Code 설정 (권장)

### 6.1 워크스페이스 설정

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },

  "eslint.validate": [
    "typescript",
    "typescriptreact"
  ],

  "typescript.preferences.importModuleSpecifier": "non-relative",
  "typescript.suggest.autoImports": true
}
```

### 6.2 권장 확장

```json
// .vscode/extensions.json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss"
  ]
}
```

---

## 7. 파일 구조

```
project/
├── .vscode/
│   ├── settings.json
│   └── extensions.json
├── src/
│   └── ...
├── .eslintrc.cjs
├── .prettierrc
├── .prettierignore
├── tsconfig.json
├── tsconfig.node.json
├── vite.config.ts
└── package.json
```

---

## 8. 설정 효과 예시

### 8.1 any 사용 차단

```typescript
// ❌ ESLint 에러: @typescript-eslint/no-explicit-any
const data: any = response.data;

// ✅ 올바른 방법
interface ApiResponse {
  tasks: Task[];
}
const data: ApiResponse = response.data;
```

### 8.2 미사용 변수 감지 (의도 표현)

```typescript
// ❌ ESLint 에러: 미사용 변수
function fetchTask(id: string) {
  return api.get('/task');
}

// ✅ _ prefix로 의도 표현
function fetchTask(_id: string) {
  // id는 향후 사용 예정
  return api.get('/task');
}
```

### 8.3 type import 강제

```typescript
// ❌ ESLint 에러: consistent-type-imports
import { Task } from '@/types';

// ✅ 타입임을 명시
import type { Task } from '@/types';

// ✅ 값과 타입 혼용 시
import { api, type ApiResponse } from '@/api';
```

### 8.4 Hooks 의존성 검사

```typescript
// ⚠️ ESLint 경고: exhaustive-deps
useEffect(() => {
  fetchTasks(page);
}, []); // page가 의존성에 없음

// ✅ 의존성 명시
useEffect(() => {
  fetchTasks(page);
}, [page]);
```

### 8.5 인덱스 접근 안전성

```typescript
const tasks: Task[] = [];

// TypeScript 에러 (noUncheckedIndexedAccess)
const first: Task = tasks[0];
// 타입: Task | undefined → Task에 할당 불가

// ✅ 안전한 처리
const first = tasks[0];
if (first) {
  console.log(first.title);
}

// ✅ 또는 옵셔널 체이닝
console.log(tasks[0]?.title);
```

---

## 9. 체크리스트

### 9.1 설정 완료 확인

```
☐ tsconfig.json - strict: true 확인
☐ tsconfig.json - noUncheckedIndexedAccess: true 확인
☐ .eslintrc.cjs - no-explicit-any: error 확인
☐ .eslintrc.cjs - extends 마지막에 'prettier' 확인
☐ .prettierrc - 생성 완료
☐ VS Code 설정 - formatOnSave 활성화
```

### 9.2 동작 확인

```bash
# 타입 검사
npm run type-check

# 린트 검사
npm run lint

# 포맷팅 검사
npm run format:check
```

---

## 10. 요약

| 도구 | 핵심 설정 | 차단하는 실수 |
|:-----|:----------|:--------------|
| **TypeScript** | `strict`, `noUncheckedIndexedAccess` | 타입 불일치, null 참조, 배열 인덱스 오류 |
| **ESLint** | `no-explicit-any`, `consistent-type-imports` | any 남용, 타입/값 혼동 |
| **ESLint** | `no-unused-vars` | 죽은 코드 방치 |
| **ESLint** | `react-hooks/recommended` | Hooks 규칙 위반 |
| **Prettier** | `eslint-config-prettier` | ESLint와 충돌 |

**설계 철학**: 규칙은 적게, 효과는 크게. "왜 이 규칙이 있는가"를 설명할 수 있는 것만 포함.
